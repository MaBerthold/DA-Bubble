<div class="mainContainer">
    <div class="mainContainerHeader">
        <div class="mainContainerHeaderLogo">
            <img src="./assets/img/logo.png" alt="">
            <span>DABubble</span>
        </div>

        <div class="searchfield-container">
            <input type="text" placeholder="Code learning durchsuchen" id="headerInput" [(ngModel)]="searchInput"
                (input)="search()">
            <div class="searchResults" *ngIf="isInputFilled">
                <ul>
                    <li *ngFor="let channel of searchResults.channels" (click)="searchfieldShowChannel(channel)">
                        # {{ channel.channelname }}
                    </li>
                    <li *ngFor="let user of searchResults.users" (click)="searchfieldShowUser(user)">
                        &commat; {{ user.firstname }} {{ user.lastname }}
                    </li>
                </ul>
            </div>
        </div>


        <div class="mainContainerHeaderProfil">
            <span class="mainContainerHeaderProfilName">{{ isEditMode ? editedUserFullName : userFullName }}</span>
            <div class="profile" (click)="openUserInfoResponsiv()">
                <img class="profile-img" [src]="getProfileImagePath()" alt="">
                <p class="active-point" *ngIf="this.userIsOnline"></p>
            </div>
            <mat-icon (click)="toggleProfileMenu()" class="logout-icon">keyboard_arrow_down</mat-icon>
            <div class="profil-info-header" *ngIf="isProfileMenuOpen"
                [ngClass]="{'mobile-view': screenWidth <= 750 && isProfileInfoOpen || isEditMode}">
                <div *ngIf="screenWidth <= 750" [ngClass]="{'d-none': screenWidth <= 750 && isProfileInfoOpen}">
                    <img src="./assets/img/line-user-info.png">
                </div>
                <div (click)="openUserInfo()" class="profile" (mouseover)="isProfileHovered = true"
                    (mouseout)="isProfileHovered = false"
                    [ngClass]="{'d-none': screenWidth <= 750 && isProfileInfoOpen  || isEditMode}">
                    <img *ngIf="screenWidth <= 750"
                        [src]="isProfileHovered ? './assets/img/account_circle_hover.png' : './assets/img/account_circle.png'">
                    <span>Profil</span>
                </div>
                <div (click)="logout(user.id)" class="logout" (mouseover)="isLogoutHovered = true"
                    (mouseout)="isLogoutHovered = false"
                    [ngClass]="{'d-none': screenWidth <= 750 && isProfileInfoOpen  || isEditMode}">
                    <img *ngIf="screenWidth <= 750"
                        [src]="isLogoutHovered ? './assets/img/logout_hover.png' : './assets/img/logout.png'">
                    <span>Log out</span>
                </div>

                <div class="user-info-details" *ngIf="isProfileInfoOpen">
                    <div class="user-info-header">
                        <p class="title">Profil</p>
                        <mat-icon (click)="closeUserInfo()" class="close-icon">close</mat-icon>
                    </div>
                    <img [src]="getProfileImagePath()" alt="">
                    <div class="user-info-name">
                        <p class="username">{{ userFullName }}</p>
                        <p *ngIf="!authService.isUserAnonymous()" (click)="openEditUser()" class="edit-link">Bearbeiten
                        </p>
                    </div>
                    <div class="user-info">
                        <p class="active-point"></p>
                        <p>Aktive</p>
                    </div>
                    <div class="user-email">
                        <mat-icon>mail_outline</mat-icon>
                        <div class="user-email-address">
                            <p>E-Mail-Adresse</p>
                            <p class="email-address">{{ user.email }}</p>
                        </div>
                    </div>
                </div>

                <div class="user-edit" *ngIf="isEditMode">
                    <div class="user-info-header">
                        <p class="title">Dein Profil bearbeiten</p>
                        <mat-icon (click)="closeEditUser()" class="close-icon">close</mat-icon>
                    </div>
                    <div class="edit-profile">
                        <img [src]="getProfileImagePath()" alt="">
                        <img (click)="toggleChangeImagePopup()" class="edit-image-icon"
                            src="./assets/img/edit-image.png">

                        <div class="edit-profile-image-popup" *ngIf="isChangeImagePopupOpen">
                            <div (click)="openAvatar()">Avatare auswählen</div>
                            <div>
                                <label for="img" class="btn upload">Eigenes Bild auswählen</label>
                                <input type="file" id="img" style="display:none;" (change)="uploadFiles($event)">
                            </div>
                        </div>

                        <div class="choose-avatar" *ngIf="isChooseAvatarOpen">
                            <div class="choose-avatar-header">
                                <mat-icon (click)="closeAvatar()">arrow_back</mat-icon>
                                <p>Wählen Sie einen Avatar<br> aus der Liste</p>
                            </div>
                            <div id="avatarSelection">
                                <img (click)="selectAvatar(1)" class="avatar-pic" src="./assets/img/avatar1.png">
                                <img (click)="selectAvatar(2)" class="avatar-pic" src="./assets/img/avatar2.png">
                                <img (click)="selectAvatar(3)" class="avatar-pic" src="./assets/img/avatar3.png">
                                <img (click)="selectAvatar(4)" class="avatar-pic" src="./assets/img/avatar4.png">
                                <img (click)="selectAvatar(5)" class="avatar-pic" src="./assets/img/avatar5.png">
                                <img (click)="selectAvatar(6)" class="avatar-pic" src="./assets/img/avatar6.png">
                            </div>
                        </div>

                    </div>
                    <div class="edit-container">
                        <div class="input-fields">
                            <div class="title-input">
                                <img src="./assets/img/account_circle.png">
                                <p>Vollständiger Name</p>
                            </div>
                            <input [(ngModel)]="userFullName" name="fullName" placeholder="Vor- und Nachname">
                        </div>
                        <div class="input-fields">
                            <div class="title-input">
                                <mat-icon>mail_outline</mat-icon>
                                <p>E-Mail-Adresse</p>
                            </div>
                            <input [(ngModel)]="user.email" name="email" placeholder="E-Mail-Adresse">
                        </div>
                    </div>
                    <div class="button-container">
                        <button (click)="closeEditUser()" class="cancel-btn" type="button">Abbrechen</button>
                        <button (click)="saveUserChange()" class="save-btn" type="button">Speichern</button>
                    </div>

                    <div class="confirm-container" *ngIf="emailChanged">
                        <div class="confirm-text">E-Mail wurde gesendet. Bitte bestätigen Sie die neue E-Mail-Adresse.
                        </div>
                    </div>
                </div>
            </div>
            <div class="overlay" *ngIf="isProfileMenuOpen" (click)="toggleProfileMenu()"></div>
        </div>
    </div>

    <div class="mainContainerContent">
        <app-workspace></app-workspace>
        <app-chat-container *ngIf="chatOpen"></app-chat-container>
        <app-channel-chat *ngIf="channelOpen"  [userProfileView]="userProfileView"></app-channel-chat>
        <app-thread *ngIf="threadOpen"></app-thread>
    </div>
</div>